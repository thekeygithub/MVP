<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.css" rel="stylesheet" />
		<script src="../js/mui.js"></script>
		<script src="../js/jquery-2.0.3.min.js"></script>
		<script src="../js/public.js" type="text/javascript" charset="utf-8"></script>
		<style>
			.payment-btn{
				width: 94%;
				margin: 2px auto 10px;
				background-color: #DF5000;
				border: 1px solid #FF5053;
			}
			.payment-span{
				margin-right: 8px;
				float: right;
			}
			.changePayMent{
				height: 30px;
				line-height: 30px;
				padding-left: 10px;
				background-color: #fff;
			}
			.mui-content{
				padding-top: 40px !important;
			}
			.mui-bar-nav{
				-webkit-box-shadow:none;
				box-shadow: none;
			}
			.mui-table-view{
				margin-bottom: 10px;
			}
			.mui-content > .mui-table-view:first-child{
				margin-top: 0;
			}
			.mui-checkbox label{
				padding-left: 0;
			}
		</style>
		<script type="text/javascript">
			mui.init()
			var isCheck=0;
			var jsessionid=getUrlParam(document.URL,"jsessionid");
			var phone=getUrlParam(document.URL,"phone");
			var hospitalId=getUrlParam(document.URL,"hospitalId");
			var money=0;
			var is_direct_pay=0;
			var self_pay_part="";
			money=0;
			$(function(){
				getInfoDetail();
			});
			function getInfoDetail(){
				var aoData=[];
				aoData.push({"name":"id","value":hospitalId});
				aoData.push({"name":"token","value":jsessionid});
				aoData.push({"name":"mobile","value":phone});
				$.ajax({
					url:''+getUrlBase()+'/applyController/getMedicalRegisterationById',
					data:aoData,
					dataType:"json",
					type:'post',
					headers:{},
					success:function(res){
						self_pay_part=res.body.self_pay_part;
						money=res.body.self_pay_part;
						$("#hospitalName").html(res.body.medical_hospital);
						$(".money").html(res.body.self_pay_part);
						$("#totalMoney").html(res.body.amount);
						// mui.toast(''+res.body.amount-res.body.self_pay_part+'',{ duration:'long', type:'div' });
						  var nums='';
						nums+=res.body.amount-res.body.self_pay_part;
						var numss=nums.substring(0,5);
						$("#payMoeny").html(numss);
					}
				});	
			}
			function payment(){
				//submitCallback();
				if($('input:radio[name="radio1"]:checked').val()==null){
					mui.alert("请选择支付方式","提示","确认",verificationCallback,{type:"div"});
				}else{
					try{
						window.android.toCheck();
						//window.android.toGACheck();
					}catch(e){
					}
				}
			}
			function verificationCallback(){}
			function afterAndroidCheck(status){
				if(status==2){
					successCallback();
				}else{
					failCallback();
				}
			}
			//是否直赔
			function directClaim(chedck){
				if ( chedck.checked == true){
					isCheck=1;
					//money=(money*0.3).toFixed(2);
					$(".money").html(0);
					is_direct_pay=1;
				}else{
					//money=money/0.3;
					is_direct_pay=0;
					$(".money").html(money);
				}
			}
			function successCallback(){
				mui.alert("验证成功，数据提交中","提示","确认",submitCallback,{type:"div"});
			}
			function failCallback(){
				mui.alert("验证失败，请重新验证","提示","确认",submitFailCallback,{type:"div"});
			}
			function submitCallback(){
				try{
					var pay_type = $("input[name='radio1']:checked").val();
					var aoData=[];
					aoData.push({"name":"id","value":hospitalId});
					aoData.push({"name":"pay_type","value":pay_type});
					aoData.push({"name":"is_direct_pay","value":is_direct_pay});
					aoData.push({"name":"self_pay_part","value":self_pay_part});
					aoData.push({"name":"token","value":jsessionid});
					aoData.push({"name":"mobile","value":phone});
					$.ajax({
						url:''+getUrlBase()+'/applyController/payMedicalRegisteration',
						data:aoData,
						dataType:"json",
						type:'post',
						headers:{},
						success:function(res){
							if(res.status){
								mui.alert("提交成功","提示","确认",submitFailCallbacks,{type:"div"});
							}else{
								mui.alert("提交失败","提示","确认",submitFailCallback,{type:"div"});
							}
						},
						error: function(XMLHttpRequest, textStatus, errorThrown){
							mui.alert(""+textStatus+"","提示","确认",submitFailCallback,{type:"div"});
						}
					});	
				}catch(e){
					mui.alert("error1 "+e.message,"提示","确认",submitFailCallback,{type:"div"});
				}
				
			}
			function submitFailCallback(){
			}
			function submitFailCallbacks(){
				window.location.href="balance.html?jsessionid="+jsessionid+"&phone="+phone;
			}
			function getUrlParam(xurl,name){
				var para="";
				if(xurl.lastIndexOf("?")>0){
					para=xurl.substring(xurl.lastIndexOf("?")+1,xurl.length);
					var arr=para.split("&");
					para="";
					for(var i=0;i<arr.length;i++){
					if(arr[i].split("=")[0]==name) return arr[i].split("=")[1];
					}
					return "";
			}else{
					return "";
			}
			}
		</script>
	</head>
	<body>
		
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">支付</h1>
		</header>
		<div class="mui-content">
			<ul class="mui-table-view">
				<li class="mui-table-view-cell">总计金额:<span class="payment-span" id="totalMoney"></span>CNY</li>
				<li class="mui-table-view-cell">商品详述:<span class="payment-span">诊疗费用</span></li>
				<li class="mui-table-view-cell">交易帐单:<span class="payment-span">0000142000022000222</span></li>
			</ul>
			<ul class="mui-table-view">
				<li class="mui-table-view-cell">收款方:<span class="payment-span" id="hospitalName"></span></li>
				<li class="mui-table-view-cell">医保统筹支付:<span class="payment-span" id="payMoeny"></span>CNY</li>
				<!-- <li class="mui-table-view-cell">个人支付:<span class="payment-span">￥230.00</span></li> -->
			</ul>
			<!-- <ul class="mui-table-view">
				<li class="mui-table-view-cell">商保报案:<span class="payment-span">生命人寿</span></li>
				<li class="mui-table-view-cell">商保报销金额:<span class="payment-span">￥200.00</span></li>
				<li class="mui-table-view-cell">个人支付:<span class="payment-span">￥20.00</span></li>
			</ul> -->
			<ul class="mui-table-view">
				<li class="mui-table-view-cell">
					<div class="mui-input-row mui-checkbox">
						<label>是否直赔</label>
						<input name="checked" type="checkbox" onclick="directClaim(this)">
					</div>
				</li>
				<li class="mui-table-view-cell">个人支付:<span class="payment-span money"></span> CNY</li>
			</ul>
				
			<div class="mui-row changePayMent">
				选择支付方式
			</div>
			<div class="mui-row">
				<div class="mui-input-row mui-radio">
					<label>TKY支付</label>
					<input name="radio1" type="radio" value="TKY支付">
				</div>
				<div class="mui-input-row mui-radio">
					<label>微信支付</label>
					<input name="radio1" type="radio" value="微信支付">
				</div>
				<div class="mui-input-row mui-radio">
					<label>支付宝支付</label>
					<input name="radio1" type="radio" value="支付宝支付">
				</div>
			</div>
			<button type="button" class="mui-btn mui-btn-blue mui-btn-block payment-btn" onclick="payment()">支付</button>
		</div>
	</body>

</html>
